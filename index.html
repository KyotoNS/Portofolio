<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar System Flight</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #0b0217;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
        }
        canvas {
            display: block;
            cursor: default;
        }
        #mainSceneCanvas {
            display: none; /* Awalnya disembunyikan */
        }
        .info {
            position: absolute;
            top: 20px;
            width: 100%;
            color: white;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            display: none; /* Awalnya disembunyikan */
        }
    </style>
</head>
<body>
    <canvas id="sceneCanvas"></canvas>
    <canvas id="mainSceneCanvas"></canvas>
    <div id="infoText" class="info">Gunakan WASD/Panah untuk Bergerak | Spasi untuk Naik, Shift Kiri untuk Turun</div>

    <!-- Import Map untuk Three.js -->
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.138.0/build/three.module.js"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // ====================================================================
        // BAGIAN 1: PEMUAT (LOADER) TATA SURYA 2D (Tidak berubah)
        // ====================================================================
        const loaderCanvas = document.getElementById('sceneCanvas');
        const ctx = loaderCanvas.getContext('2d');

        let width, height;
        let stars2D = [];
        const numStars2D = 500;
        let time = 0;
        let loadingProgress = 0;
        let animationState = 'loading'; // 'loading', 'loaded', 'warping', 'faded'
        let warpFactor = 0;

        const sun = { name: 'Sun', color: 'rgba(255, 223, 100, 1)', radius: 25, glow: 'rgba(255, 200, 0, 0.5)' };
        const planets = [
            { name: 'Mercury', color: '#B5A7A2', radius: 4, orbitRadius: 60, speed: 0.02 },
            { name: 'Venus', color: '#E8B36F', radius: 7, orbitRadius: 90, speed: 0.015 },
            { name: 'Earth', color: '#6B93D6', radius: 8, orbitRadius: 130, speed: 0.01 },
            { name: 'Mars', color: '#C1440E', radius: 6, orbitRadius: 180, speed: 0.008 },
            { name: 'Jupiter', color: '#D8CA9D', radius: 15, orbitRadius: 240, speed: 0.005 },
            { name: 'Saturn', color: '#C7A585', radius: 12, orbitRadius: 310, speed: 0.003, ring: true },
            { name: 'Uranus', color: '#A9D0F5', radius: 10, orbitRadius: 370, speed: 0.002 },
            { name: 'Neptune', color: '#3F5EAB', radius: 10, orbitRadius: 430, speed: 0.001 },
        ];
        const iconPaths = ["M0,-20 Q15,-15 10,0 Q5,15 0,20 Q-5,15 -10,0 Q-15,-15 0,-20 Z M0,-10 Q5,-5 0,0 Q-5,-5 0,-10 Z","M-15,5 Q-5,15 0,5 Q5,-5 -5,-15 M15,5 Q5,15 0,5 Q-5,-5 5,-15","M0,-17.5 L15,2.5 L0,7.5 L-15,2.5 Z M-8,-2.5 L0,17.5 L8,-2.5","M-2.5,15 A15,15 0 0,0 15,-2.5 M-15,2.5 A10,10 0 0,1 2.5,-15 M-10,-10 L5,5","M0,-17.5 C15,-7.5 8,17.5 0,12.5 C-8,17.5 -15,-7.5 0,-17.5 Z","M0,-20 L0,20 M-15,-10 L15,10 M-15,10 L15,-10 M-9,-17 L9,17 M-9,17 L9,-17","M0,-20 L17,0 L0,20 L-17,0 Z M0,-10 L8.5,0 L0,10 L-8.5,0 Z","M0,0 A13,13 0 1,0 0,1 M-13,0 L13,0 M0,-15 L0,15","M-13,-13 L13,13 M-13,13 L13,-13 M0,-20 L0,20"];
        
        function setupLoader() { width = loaderCanvas.width = window.innerWidth; height = loaderCanvas.height = window.innerHeight; create2DStars(); loaderCanvas.addEventListener('click', handleLoaderClick); loaderCanvas.addEventListener('mousemove', handleLoaderMouseMove); }
        function create2DStars() { stars2D = []; for (let i = 0; i < numStars2D; i++) { stars2D.push({ x: Math.random() * width, y: Math.random() * height, radius: Math.random() * 1.5 + 0.5, alpha: Math.random(), twinkleSpeed: Math.random() * 0.03 + 0.01 }); } }
        function draw2DStars() { const centerX = width/2, centerY = height/2; for(const star of stars2D){ if(animationState==='warping'){ const dx=star.x-centerX, dy=star.y-centerY, endX=star.x+dx*warpFactor*0.5, endY=star.y+dy*warpFactor*0.5; ctx.beginPath(); ctx.moveTo(star.x,star.y); ctx.lineTo(endX,endY); ctx.strokeStyle=`rgba(255,255,255,${1-warpFactor})`; ctx.lineWidth=star.radius; ctx.stroke(); }else{ star.alpha=Math.abs(Math.sin(time*star.twinkleSpeed)); ctx.beginPath(); ctx.arc(star.x,star.y,star.radius,0,Math.PI*2); ctx.fillStyle=`rgba(255,255,255,${star.alpha})`; ctx.fill(); }}}
        function drawSolarSystem() { ctx.save(); ctx.translate(width/2,height/2-50); if(animationState!=='warping'){ctx.strokeStyle=`rgba(255,255,255,0.1)`; ctx.lineWidth=1; planets.forEach((p,i)=>{if(loadingProgress>(i+1)*(100/9)){ctx.beginPath();ctx.ellipse(0,0,p.orbitRadius,p.orbitRadius,0,0,2*Math.PI);ctx.stroke()}})} const sunPulse=animationState==='loaded'?Math.sin(time*0.1)*5:0, sunWarpSize=animationState==='warping'?width*warpFactor*1.5:0; ctx.shadowBlur=20+sunPulse+(warpFactor*100); ctx.shadowColor=sun.glow; ctx.fillStyle=sun.color; ctx.beginPath(); ctx.arc(0,0,sun.radius+sunPulse+sunWarpSize,0,2*Math.PI); ctx.fill(); ctx.shadowBlur=0; planets.forEach((p,i)=>{if((animationState==='loading'&&loadingProgress>(i+1)*(100/9))||animationState!=='loading'){const angle=time*p.speed; let x=p.orbitRadius*Math.cos(angle), y=p.orbitRadius*Math.sin(angle), radius=p.radius; ctx.globalAlpha=1; if(animationState==='warping'){const warpScale=1+warpFactor*3; x*=warpScale; y*=warpScale; radius*=warpScale; ctx.globalAlpha=1-warpFactor} ctx.fillStyle=p.color; ctx.beginPath(); ctx.arc(x,y,radius,0,2*Math.PI); ctx.fill(); if(p.ring){ctx.strokeStyle=p.color; ctx.lineWidth=2*(animationState==='warping'?1+warpFactor*3:1); ctx.beginPath(); ctx.ellipse(x,y,radius*2,radius*0.5,Math.PI/4,0,2*Math.PI); ctx.stroke()}}}); ctx.globalAlpha=1; ctx.restore(); }
        function drawLoadingIcons() { if(animationState==='warping'||animationState==='faded')return; const iconSize=25, numIcons=9, spacing=30, totalWidth=numIcons*iconSize+(numIcons-1)*spacing; let startX=(width-totalWidth)/2; const y=height-60; iconPaths.forEach((pathString,i)=>{const step=100/numIcons, isActive=loadingProgress>=i*step, activeColor='rgba(255,223,100,1)', inactiveColor='rgba(255,255,255,0.2)'; ctx.save(); let finalX=startX+iconSize/2; if(i===7)finalX+=10; ctx.translate(finalX,y); ctx.scale(0.8,0.8); const path=new Path2D(pathString); ctx.strokeStyle=isActive?activeColor:inactiveColor; ctx.lineWidth=2; ctx.stroke(path); if(isActive){const fillAmount=(loadingProgress-i*step)/step; ctx.save(); ctx.clip(path); ctx.fillStyle=activeColor; ctx.fillRect(-iconSize,iconSize-(fillAmount*iconSize*2),iconSize*2,iconSize*2); ctx.restore()} ctx.restore(); startX+=iconSize+spacing;}); }
        function animateLoader() { time += 1; if (animationState === 'loading') { if (loadingProgress < 100) { loadingProgress += 0.5; } else { loadingProgress = 100; animationState = 'loaded'; } } else if (animationState === 'warping') { if (warpFactor < 1) { warpFactor += 0.01; } else { warpFactor = 1; animationState = 'faded'; transitionToMainScene(); return; } } ctx.clearRect(0, 0, width, height); draw2DStars(); drawSolarSystem(); drawLoadingIcons(); requestAnimationFrame(animateLoader); }
        function handleLoaderClick(e) { if(animationState!=='loaded')return; const rect=loaderCanvas.getBoundingClientRect(), mouseX=e.clientX-rect.left, mouseY=e.clientY-rect.top, sunScreenX=width/2, sunScreenY=height/2-50, distance=Math.sqrt((mouseX-sunScreenX)**2+(mouseY-sunScreenY)**2); if(distance<sun.radius+10){animationState='warping';} }
        function handleLoaderMouseMove(e) { if(animationState!=='loaded'){loaderCanvas.style.cursor='default';return;} const rect=loaderCanvas.getBoundingClientRect(), mouseX=e.clientX-rect.left, mouseY=e.clientY-rect.top, sunScreenX=width/2, sunScreenY=height/2-50, distance=Math.sqrt((mouseX-sunScreenX)**2+(mouseY-sunScreenY)**2); if(distance<sun.radius+10){loaderCanvas.style.cursor='pointer';}else{loaderCanvas.style.cursor='default';}}
        window.addEventListener('resize', setupLoader);
        setupLoader();
        animateLoader();

        // ====================================================================
        // BAGIAN 2: SCENE 3D PESAWAT (Diperbarui)
        // ====================================================================
        let scene, camera, renderer, plane, clock;
        const starSystems = []; // Array untuk menampung lapisan bintang
        const keysPressed = {};
        const planeVelocity = new THREE.Vector3(0, 0, 0);
        const moveSpeed = 50;

        function transitionToMainScene() {
            document.getElementById('sceneCanvas').style.display = 'none';
            document.getElementById('mainSceneCanvas').style.display = 'block';
            document.getElementById('infoText').style.display = 'block';
            initMainScene();
        }

        function initMainScene() {
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x0b0217, 100, 500);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 20);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('mainSceneCanvas'), antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x0b0217);

            clock = new THREE.Clock();

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(50, 50, 50);
            scene.add(dirLight);

            plane = createUFO(); // Mengganti nama fungsi
            scene.add(plane);
            
            // Membuat latar belakang bintang 3D
            create3DStars();

            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);

            animateMainScene();
        }

        function createUFO() {
            const ufoGroup = new THREE.Group();

            // Material untuk badan piring terbang
            const bodyMat = new THREE.MeshStandardMaterial({
                color: 0xaaaaaa,
                metalness: 0.9,
                roughness: 0.2
            });

            // Material untuk kubah kokpit
            const cockpitMat = new THREE.MeshStandardMaterial({
                color: 0x99ddff,
                roughness: 0.1,
                transparent: true,
                opacity: 0.6
            });

            // Bentuk piringan utama (silinder lebar dan datar)
            const saucerGeo = new THREE.CylinderGeometry(4, 4, 1, 32);
            const saucer = new THREE.Mesh(saucerGeo, bodyMat);
            saucer.scale.y = 0.5; // Membuatnya lebih pipih
            ufoGroup.add(saucer);

            // Kubah kokpit (setengah bola)
            const cockpitGeo = new THREE.SphereGeometry(2, 32, 16, 0, Math.PI * 2, 0, Math.PI / 2);
            const cockpit = new THREE.Mesh(cockpitGeo, cockpitMat);
            cockpit.position.y = 0.25; // Letakkan di atas piringan
            ufoGroup.add(cockpit);

             // Kubah bawah/sumber cahaya
            const bottomGeo = new THREE.SphereGeometry(1.5, 32, 16, 0, Math.PI * 2, Math.PI/2, Math.PI / 2);
            const bottom = new THREE.Mesh(bottomGeo, bodyMat);
            bottom.position.y = -0.25;
            ufoGroup.add(bottom);

            return ufoGroup;
        }

        function createStarTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 32;
            canvas.height = 32;
            const context = canvas.getContext('2d');
            const gradient = context.createRadialGradient(16, 16, 0, 16, 16, 16);
            gradient.addColorStop(0, 'rgba(255,255,255,1)');
            gradient.addColorStop(0.2, 'rgba(255,255,255,0.7)');
            gradient.addColorStop(1, 'rgba(255,255,255,0)');
            context.fillStyle = gradient;
            context.fillRect(0, 0, 32, 32);
            return new THREE.CanvasTexture(canvas);
        }

        function create3DStars() {
            // Helper function to create a layer of stars
            const createStarLayer = (count, size, hueRange) => {
                const starGeometry = new THREE.BufferGeometry();
                const starMaterial = new THREE.PointsMaterial({
                    size: size, // Gunakan ukuran yang diberikan
                    sizeAttenuation: true,
                    transparent: true,
                    alphaTest: 0.5,
                    map: createStarTexture(),
                    vertexColors: true
                });

                const starVertices = [];
                const starColors = [];
                const [hueStart, hueEnd] = hueRange;
                const hueSpan = hueEnd - hueStart;

                for (let i = 0; i < count; i++) {
                    const x = (Math.random() - 0.5) * 2000;
                    const y = (Math.random() - 0.5) * 2000;
                    const z = (Math.random() - 0.5) * 2000;
                    starVertices.push(x, y, z);

                    const color = new THREE.Color();
                    const hue = hueStart + Math.random() * hueSpan;
                    color.setHSL(hue, 0.8, 0.7);
                    starColors.push(color.r, color.g, color.b);
                }

                starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
                starGeometry.setAttribute('color', new THREE.Float32BufferAttribute(starColors, 3));

                const stars = new THREE.Points(starGeometry, starMaterial);
                scene.add(stars);
                starSystems.push(stars); // Simpan untuk animasi
            };

            // Membuat beberapa lapisan bintang dengan ukuran dan warna berbeda untuk variasi
            createStarLayer(200000, 0.5, [0.5, 0.7]); // Bintang sangat kecil (biru/ungu)
            createStarLayer(150000, 1.0, [0.0, 0.15]); // Bintang kecil (merah/oranye)
            createStarLayer(100000, 1.5, [0.16, 0.3]); // Bintang sedang (kuning/hijau)
            createStarLayer(50000, 2.0, [0.7, 0.9]);   // Bintang agak besar (ungu/merah muda)
        }


        function handleKeyDown(event) {
            keysPressed[event.key.toLowerCase()] = true;
        }
        function handleKeyUp(event) {
            keysPressed[event.key.toLowerCase()] = false;
        }

        function animateMainScene() {
            requestAnimationFrame(animateMainScene);
            const delta = clock.getDelta();
            const elapsedTime = clock.getElapsedTime();


            const targetVelocity = new THREE.Vector3(0, 0, 0);

            // Kontrol Maju/Mundur/Kiri/Kanan
            if (keysPressed['w'] || keysPressed['arrowup']) { targetVelocity.z = -1; }
            if (keysPressed['s'] || keysPressed['arrowdown']) { targetVelocity.z = 1; }
            if (keysPressed['a'] || keysPressed['arrowleft']) { targetVelocity.x = -1; }
            if (keysPressed['d'] || keysPressed['arrowright']) { targetVelocity.x = 1; }
            
            // Kontrol Naik/Turun
            if (keysPressed[' ']) { targetVelocity.y = 1; } // Spasi
            if (keysPressed['shift']) { targetVelocity.y = -1; } // Shift Kiri

            // Muluskan kecepatan aktual pesawat menuju kecepatan target
            planeVelocity.lerp(targetVelocity, 0.1);

            // Perbarui posisi pesawat
            plane.position.x += planeVelocity.x * delta * moveSpeed;
            plane.position.z += planeVelocity.z * delta * moveSpeed;
            plane.position.y += planeVelocity.y * delta * moveSpeed;
            
            // Tambahkan sedikit efek melayang untuk UFO
            plane.position.y += Math.sin(elapsedTime * 2) * 0.01;


            // Efek miring untuk UFO
            plane.rotation.z = planeVelocity.x * -0.2; // Miring (Roll) ke kiri/kanan
            plane.rotation.y += 0.005; // Membuat UFO berputar perlahan pada porosnya
            plane.rotation.x = planeVelocity.z * 0.2;  // Miring (Pitch) ke depan/belakang

            // Animasikan bintang agar bergerak/berkedip
            starSystems.forEach((stars, index) => {
                // Putar setiap lapisan bintang secara perlahan dengan kecepatan berbeda untuk efek paralaks
                stars.rotation.y += 0.0001 * (index + 1);
                stars.rotation.x += 0.00005 * (index + 1);
            });

            // Kamera mengikuti pesawat dengan mulus
            const idealOffset = new THREE.Vector3(0, 5, 15);
            const targetCameraPosition = plane.position.clone().add(idealOffset);
            camera.position.lerp(targetCameraPosition, 0.1);
            camera.lookAt(plane.position);


            renderer.render(scene, camera);
        }
    </script>
</body>
</html>

